<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Google 로그인</title>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"></script>
</head>
<body>
<button onclick="loginWithGoogle()">Google로 로그인</button>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC40UBmDLN-4cAOO5T_G4cZ1eITfNko0r8",
        authDomain: "authentication-51f15.firebaseapp.com",
        projectId: "authentication-51f15",
        storageBucket: "authentication-51f15.firebasestorage.app",
        messagingSenderId: "1062630277620",
        appId: "1:1062630277620:web:7e5175f0327f6eb6c179a1",
        measurementId: "G-PWLV24FWNW"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    function loginWithGoogle() {
        auth.signInWithPopup(provider)
            .then((result) => result.user.getIdToken())
            .then((idToken) => {
                console.log("Firebase ID Token:", idToken);

                // ✅ Spring 백엔드로 ID 토큰 전송
                fetch("http://localhost:8080/api/auth/firebase-login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ idToken })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("서버 응답 실패");
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Spring 서버 응답:", data);
                        alert(`${data.username || "사용자"}님 환영합니다!`);
                        // 예: localStorage.setItem("accessToken", data.accessToken);
                    })
                    .catch((error) => {
                        console.error("백엔드 통신 실패:", error);
                        alert("로그인 중 문제가 발생했습니다.");
                    });
            })
            .catch((error) => {
                console.error("Firebase 로그인 실패:", error);
                alert("로그인 실패");
            });
    }
</script>
</body>
</html>